---
title: Yönetilmeyen Kod İçin Güvenli Kodlama Yönergeleri
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 867157b329218b79c8cc1255b2158bbe83666531
ms.sourcegitcommit: 289e06e904b72f34ac717dbcc5074239b977e707
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/17/2019
ms.locfileid: "71045363"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="3ae5e-102">Yönetilmeyen Kod İçin Güvenli Kodlama Yönergeleri</span><span class="sxs-lookup"><span data-stu-id="3ae5e-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="3ae5e-103">Bazı kitaplık kodunun yönetilmeyen koda (örneğin, Win32 gibi yerel kod API 'Leri) çağırması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="3ae5e-104">Bu, yönetilen kod için güvenlik çevresi dışında bir süre içinde olduğu için dikkat gerektiren nedenlerle gereklidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="3ae5e-105">Kodunuz güvenlik tarafsız ise, hem kodunuz hem de bunu çağıran tüm kodlar yönetilmeyen kod iznine sahip olmalıdır (<xref:System.Security.Permissions.SecurityPermission> belirtilen <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> bayrağıyla birlikte).</span><span class="sxs-lookup"><span data-stu-id="3ae5e-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="3ae5e-106">Ancak, çağıranın bu tür güçlü izinlere sahip olması genellikle mantıklı değildir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="3ae5e-107">Bu gibi durumlarda, güvenilen kodunuz, [sarmalayıcı kodunu güvenli hale](../misc/securing-wrapper-code.md)getirmek için tanımlanan yönetilen sarmalayıcıya veya kitaplık koduna benzer şekilde, arasında hareket edebilir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="3ae5e-108">Temel alınan yönetilmeyen kod işlevselliği tamamen güvende ise, doğrudan açığa çıkabilir; Aksi takdirde, önce uygun bir izin denetimi (istek) gereklidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="3ae5e-109">Kodunuz yönetilmeyen koda çağırdığında ancak çağıranlarınızın yönetilmeyen koda erişim izni olmasını gerektirmek istiyorsanız, doğru onay yapmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="3ae5e-110">Bir onaylama işlemi, kariyerinize yol gösterecek şekilde blok yapar.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="3ae5e-111">Bu işlemde bir güvenlik deliği oluşturmamaya dikkat etmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="3ae5e-112">Bu, genellikle çağıranlarınızın uygun bir iznini talep etmeniz ve yönetilmeyen kod kullanarak yalnızca bu iznin izin verdiği ve daha fazla izin verdiğini yapmanız gerektiği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="3ae5e-113">Bazı durumlarda (örneğin, bir gün saati), yönetilmeyen kod herhangi bir güvenlik denetimi olmadan çağıranlara doğrudan sunulabilir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="3ae5e-114">Herhangi bir durumda, onay veren tüm kodlar güvenlik için sorumluluk almalıdır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="3ae5e-115">Yerel koda bir kod yolu sağlayan herhangi bir yönetilen kod, kötü amaçlı kod için olası bir hedeftir, bu nedenle hangi yönetilmeyen kodun güvenli bir şekilde kullanılabileceğini ve kullanılması gereken çok dikkatli olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="3ae5e-116">Genellikle, yönetilmeyen kod asla kısmen güvenilen çağıranlar için hiçbir şekilde doğrudan gösterilmemelidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="3ae5e-117">Kısmen güvenilen kod tarafından çağrılabilir olan kitaplıklarda yönetilmeyen kod kullanımı güvenliğini değerlendirmek için başlıca iki önemli noktalar vardır:</span><span class="sxs-lookup"><span data-stu-id="3ae5e-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
- <span data-ttu-id="3ae5e-118">**İşlevselliği**.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-118">**Functionality**.</span></span> <span data-ttu-id="3ae5e-119">Yönetilmeyen API, çağıranların potansiyel olarak tehlikeli işlemler gerçekleştirmesine izin verilmeyen işlevler sağlıyor mu?</span><span class="sxs-lookup"><span data-stu-id="3ae5e-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="3ae5e-120">Kod erişim güvenliği, kaynaklara erişimi zorlamak için izinleri kullanır, bu nedenle API 'nin dosyaları, Kullanıcı arabirimini veya iş parçacığı kullanıp kullanmadığını veya korunan bilgileri kullanıp kullanmadığını düşünün.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="3ae5e-121">Varsa, yönetilen kod sarmalama, girilmeye izin vermeden önce gerekli izinleri talep etmelidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="3ae5e-122">Ayrıca, bir izin tarafından korunmadığında, bellek erişiminin katı tür güvenliği ile sınırlandırımış olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
- <span data-ttu-id="3ae5e-123">**Parametre denetimi**.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-123">**Parameter checking**.</span></span> <span data-ttu-id="3ae5e-124">Yaygın saldırı, yönetilmeyen kod API yöntemlerine sunulan beklenmedik parametreleri, bunların belirtim dışında çalışmasına neden olan bir girişimle geçirir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="3ae5e-125">Aralık dışı dizin veya fark değerleri kullanılarak yapılan arabellek taşmaları, temel koddaki bir hatadan faydalanan her türlü parametre gibi bu tür bir saldırının yaygın bir örneğidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="3ae5e-126">Bu nedenle, kısmen güvenilen çağıranlar için yönetilmeyen kod API 'SI işlevsel güvenli olsa bile, yönetilen kod aynı zamanda, yönetilen bir kod tarafından kötü amaçlı koddan hiçbir istenmeyen çağrının olmamasını sağlamak kod sarmalayıcı katmanı.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="3ae5e-127">SuppressUnmanagedCodeSecurityAttribute Kullanma</span><span class="sxs-lookup"><span data-stu-id="3ae5e-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="3ae5e-128">Yönetilmeyen kodu ele almak ve ardından çağırmak için bir performans yönü vardır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="3ae5e-129">Her bu çağrı için, güvenlik sistemi otomatik olarak yönetilmeyen kod iznini talep ediyor ve bu da yığın her seferinde izlenecek bir sonuç.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="3ae5e-130">Yönetilmeyen kodu onaylama ve anında çağrı yaparsanız yığın ilerleme durumunu anlamlı bir şekilde kullanabilirsiniz: Bu, onayı ve yönetilmeyen kod çağrınızdan oluşur.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="3ae5e-131">Belirtilen <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> izin<xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> ile talep <xref:System.Security.Permissions.SecurityPermission> edilen normal güvenlik denetimini devre dışı bırakmak için, çağrılan özel bir öznitelik yönetilmeyen kod giriş noktalarına uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="3ae5e-132">Bu eylem, çalışma zamanı güvenlik denetimi olmadan yönetilmeyen koda açık bir kapılı olduğundan, her zaman çok dikkatli olunmalıdır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="3ae5e-133">**SuppressUnmanagedCodeSecurityAttribute** uygulanmış olsa da, hemen çağıranın yönetilmeyen kodu çağırma iznine sahip olduğundan emin olmak için tam ZAMANıNDA (JIT) derlemede gerçekleşen tek seferlik bir güvenlik denetimi vardır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="3ae5e-134">**SuppressUnmanagedCodeSecurityAttribute**kullanırsanız aşağıdaki noktaları kontrol edin:</span><span class="sxs-lookup"><span data-stu-id="3ae5e-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
- <span data-ttu-id="3ae5e-135">Yönetilmeyen kod giriş noktasını, kodunuzun dışından iç veya başka bir şekilde erişilemez yapın.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
- <span data-ttu-id="3ae5e-136">Yönetilmeyen koda yapılan herhangi bir çağrı olası bir güvenlik deliği.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="3ae5e-137">Kodunuzun, kötü amaçlı kodun yönetilmeyen koda dolaylı olarak çağırması ve güvenlik denetiminden kaçınmak için bir portal olmadığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="3ae5e-138">Uygunsa talep izinleri.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-138">Demand permissions, if appropriate.</span></span>  
  
- <span data-ttu-id="3ae5e-139">Aşağıdaki bölümde açıklandığı gibi, yönetilmeyen kod için tehlikeli bir yol oluştururken açıkça tanımlamak üzere bir adlandırma kuralı kullanın.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="3ae5e-140">Yönetilmeyen kod yöntemleri için adlandırma kuralı</span><span class="sxs-lookup"><span data-stu-id="3ae5e-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="3ae5e-141">Yönetilmeyen kod yöntemlerini adlandırmak için kullanışlı ve son derece önerilen bir kural oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="3ae5e-142">Tüm yönetilmeyen kod yöntemleri üç kategoride ayrılır: **güvenli**, **Yerel**ve **güvenli olmayan**.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="3ae5e-143">Bu anahtar sözcükler, çeşitli yönetilmeyen kod giriş noktası türlerinin tanımlandığı sınıf adı olarak kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="3ae5e-144">Kaynak kodunda, bu anahtar sözcüklerin `Safe.GetTimeOfDay`, `Native.Xyz`, veya `Unsafe.DangerousAPI`gibi sınıf adına eklenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="3ae5e-145">Bu anahtar sözcüklerin her biri, aşağıdaki tabloda açıklandığı gibi, bu sınıfı kullanan geliştiriciler için yararlı güvenlik bilgileri sağlar.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="3ae5e-146">Anahtar sözcüğü</span><span class="sxs-lookup"><span data-stu-id="3ae5e-146">Keyword</span></span>|<span data-ttu-id="3ae5e-147">Güvenlik konuları</span><span class="sxs-lookup"><span data-stu-id="3ae5e-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="3ae5e-148">**güven**</span><span class="sxs-lookup"><span data-stu-id="3ae5e-148">**safe**</span></span>|<span data-ttu-id="3ae5e-149">Herhangi bir kod için, hatta kötü amaçlı kod, çağırmak için tamamen zararsız.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="3ae5e-150">, Diğer yönetilen kod gibi kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-150">Can be used just like other managed code.</span></span> <span data-ttu-id="3ae5e-151">Örneğin, günün saatini alan bir işlev genellikle güvenlidir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="3ae5e-152">**Yerel**</span><span class="sxs-lookup"><span data-stu-id="3ae5e-152">**native**</span></span>|<span data-ttu-id="3ae5e-153">Güvenlikle bağımsız; diğer bir deyişle, yönetilmeyen kod iznini çağıran yönetilmeyen kod.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="3ae5e-154">Güvenlik denetlenir ve bu da yetkisiz bir çağrıyı sonlandırır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="3ae5e-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="3ae5e-155">**unsafe**</span></span>|<span data-ttu-id="3ae5e-156">Güvenliği gizlenen, potansiyel olarak tehlikeli, yönetilmeyen kod giriş noktası.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="3ae5e-157">Geliştiriciler, bu tür yönetilmeyen kodu kullanırken en büyük dikkatli bir güvenlik açığını engellemek için diğer korumaların yerinde olduğundan emin olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="3ae5e-158">Bu anahtar sözcük güvenlik sistemini geçersiz kıldığından, geliştiricilerin sorumlu olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="3ae5e-159">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="3ae5e-159">See also</span></span>

- [<span data-ttu-id="3ae5e-160">Güvenli Kodlama Yönergeleri</span><span class="sxs-lookup"><span data-stu-id="3ae5e-160">Secure Coding Guidelines</span></span>](../../standard/security/secure-coding-guidelines.md)
